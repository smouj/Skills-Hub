name: sync-skills-index

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - name: Validate repos and update LAST_SYNC.md
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -euo pipefail
          repos=(
            smouj/Aegis-Veil smouj/Phoenix-Reborn smouj/Genome-Weaver smouj/Shadow-Ledger smouj/Flux-Capacitor
            smouj/Mirror-Council smouj/Abyss-Scanner smouj/Codex-Eternal smouj/Alchemurgist smouj/Chrono-Ward
          )
          ok=0; fail=0
          {
            echo "# Last Sync Report"
            echo
            echo "- Timestamp (UTC): $(date -u +'%Y-%m-%dT%H:%M:%SZ')"
            echo "- Checked repos: ${#repos[@]}"
            echo
            echo "## Availability"
            for r in "${repos[@]}"; do
              if gh repo view "$r" >/dev/null 2>&1; then
                echo "- ✅ $r"; ok=$((ok+1))
              else
                echo "- ❌ $r"; fail=$((fail+1))
              fi
            done
            echo
            echo "- Success: $ok"
            echo "- Failed: $fail"
          } > LAST_SYNC.md
      - name: Commit report
        run: |
          set -euo pipefail
          if git diff --quiet; then exit 0; fi
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add LAST_SYNC.md
          git commit -m "chore(sync): update LAST_SYNC report"
          git push
